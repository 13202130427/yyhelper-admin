<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="__ADMIN__/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="__ADMIN__/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="__ADMIN__/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="__ADMIN__/static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="__ADMIN__/static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>鱼影学助</title>
</head>
<body>
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="container-fluid cl"> <a class="logo navbar-logo f-l mr-10 hidden-xs" href="/aboutHui.shtml">鱼影学助</a> 
			<span class="logo navbar-slogan f-l mr-10 hidden-xs">v1.0</span> 
			<a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
			<nav class="nav navbar-nav">
				<ul class="cl">
					<li class="dropDown dropDown_hover"><a href="javascript:;" class="dropDown_A"><i class="Hui-iconfont">&#xe600;</i> 新增 <i class="Hui-iconfont">&#xe6d5;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" onclick="article_add('添加资讯','article-add.html')"><i class="Hui-iconfont">&#xe616;</i> 资讯</a></li>
					</ul>
				</li>
			</ul>
		</nav>
		<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
			<ul class="cl">
				<li>{php $level}</li>
				<li class="dropDown dropDown_hover">
					<a href="#" class="dropDown_A">{php $_SESSION['manage']['username']} <i class="Hui-iconfont">&#xe6d5;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" onClick="myselfinfo()">个人信息</a></li>
						<li><a href="#">切换账户</a></li>
						<li><a href="admin/logout">退出</a></li>
				</ul>
			</li>
				<li id="Hui-msg"> <a onclick="broadcast_look('信息','/admin/broadcast/broadcast_list','600','270')" title="消息"><span class="badge badge-danger" id="broadcast_news"></span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> </li>
				<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
						
					</ul>
				</li>
			</ul>
		</nav>
	</div>
</div>
</header>
<aside class="Hui-aside">
	<div class="menu_dropdown bk_2">
		<dl id="menu-user">
			<dt><i class="Hui-iconfont">&#xe616;</i> 用户管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
			<dd>
				<ul>
					<li><a data-href="admin/user/user_list" data-title="账号列表" href="javascript:;">账号列表</a></li>
					<li><a data-href="admin/user/user_deletelist" data-title="已删除账号" href="javascript:;">已删除账号</a></li>
					<li><a data-href="admin/user/user_audit_person" data-title="实名认证审核列表" href="javascript:void(0)">实名认证审核列表</a></li>
					<li><a data-href="admin/user/user_audit_student" data-title="学生认证审核列表" href="javascript:void(0)">学生认证审核列表</a></li>
				</ul>
			</dd>
		</dl>
		<dl id="menu-route">
			<dt><i class="Hui-iconfont">&#xe616;</i> 学习路线管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
			<dd>
				<ul>
					<li><a data-href="admin/route/route_list" data-title="学习路线列表" href="javascript:;">学习路线列表</a></li>
					<li><a data-href="admin/route/route_audit" data-title="学习路线审核列表" href="javascript:;">学习路线审核列表</a></li>
				</ul>
			</dd>
		</dl>
		<dl id="menu-news">
			<dt><i class="Hui-iconfont">&#xe622;</i> 资讯管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
			<dd>
				<ul>
					<li><a data-href="admin/news/video_list" data-title="视频资讯列表" href="javascript:;">视频资讯列表</a></li>
					<li><a data-href="admin/news/news_list" data-title="新闻资讯列表" href="javascript:;">新闻资讯列表</a></li>
					<li><a data-href="admin/news/video_audit" data-title="视频资讯审查列表" href="javascript:;">视频资讯审查列表</a></li>
					<li><a data-href="admin/news/news_audit" data-title="新闻资讯审查列表" href="javascript:;">新闻资讯审查列表</a></li>
			</ul>
		</dd>
	</dl>
		<dl id="menu-admin">
			<dt><i class="Hui-iconfont">&#xe62d;</i> 管理员管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
			<dd>
				<ul>
					<li><a data-href="admin/admin/admin_role" data-title="角色管理" href="javascript:void(0)">角色管理</a></li>
					<li><a data-href="admin/admin/admin_list" data-title="管理员列表" href="javascript:void(0)">管理员列表</a></li>
			</ul>
		</dd>
	</dl>
		<dl id="menu-system">
			<dt><i class="Hui-iconfont">&#xe62e;</i> 系统管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
			<dd>
				<ul>
					<li><a data-href="admin/system/system_broadcast" data-title="成员广播" href="javascript:void(0)">成员广播</a></li>
			</ul>
		</dd>
	</dl>
</div>
</aside>
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>
<section class="Hui-article-box">
	<div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
		<div class="Hui-tabNav-wp">
			<ul id="min_title_list" class="acrossTab cl">
				<li class="active">
					<span title="我的桌面" data-href="welcome">我的桌面</span>
					<em></em></li>
		</ul>
	</div>
		<div class="Hui-tabNav-more btn-group"><a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d4;</i></a><a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d7;</i></a></div>
</div>
	<div id="iframe_box" class="Hui-article">
		<div class="show_iframe">
			<div style="display:none" class="loading"></div>
			<iframe scrolling="yes" frameborder="0" src="admin/welcome"></iframe>
	</div>
</div>
</section>

<div class="contextMenu" id="Huiadminmenu">
	<ul>
		<li id="closethis">关闭当前 </li>
		<li id="closeall">关闭全部 </li>
</ul>
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__ADMIN__/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__ADMIN__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__ADMIN__/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__ADMIN__/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ADMIN__/lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>
<script type="text/javascript">
	var broadcast = {php $broadcast};
	document.getElementById("broadcast_news").innerHTML= broadcast;
	var websocket = null;
	if('WebSocket' in window){
		wss = new WebSocket('wss://www.yyhelper.icu/ws');
	}else{
		alert('当前浏览器不支持websocket');
	}

	wss.onopen = function (e) {
		heartCheck.reset().start();      //心跳检测重置
		var data = '{"type":"bind","id":'+{php $manage_id}+'}';
		wss.send(data);
		//alert('连接成功');
	};

	wss.onclose = function (e) {
		var data = '{"type":"unbind","id":'+{php $manage_id}+'}';
		wss.send(data);
		//alert('连接关闭');
	};
	//接收第三方的消息推送
	wss.onmessage = function (e) {
		heartCheck.reset().start();      //心跳检测重置
		var message = e.data;
		if(message == 'pong'){
			console.log("pong!");

		}else{
			//alert(e.data);
			broadcast = broadcast+1;
			var Notification = window.Notification || window.mozNotification || window.webkitNotification;
			if(window.Notification){
				if(Notification.permission === 'granted'){
					new Notification('消息推送通知',{body:message});
				}else{
					Notification.requestPermission();
				}
			}document.getElementById("broadcast_news").innerHTML= broadcast;
		}
	}
	wss.onerror = function(){
		alert('websocket通信发生错误');
	}
	window.onbeforeunload = function () {
		var data = '{"type":"unbind","id":'+{php $manage_id}+'}';
		wss.send(data);
		wss.close();

	}

	//心跳检测
	var heartCheck = {
		timeout: 3000,        //3分钟发一次心跳
		timeoutObj: null,
		serverTimeoutObj: null,
		reset: function(){
			clearTimeout(this.timeoutObj);
			clearTimeout(this.serverTimeoutObj);
			return this;
		},
		start: function(){
			var self = this;
			this.timeoutObj = setTimeout(function(){
				//这里发送一个心跳，后端收到后，返回一个心跳消息，
				//onmessage拿到返回的心跳就说明连接正常
				var data = '{"type":"rec","action":"ping"}';
				wss.send(data);
				console.log("ping!");
				self.serverTimeoutObj = setTimeout(function(){//如果超过一定时间还没重置，说明后端主动断开了
					wss.close();     //如果onclose会执行reconnect，我们执行ws.close()就行了.如果直接执行reconnect 会触发onclose导致重连两次
				}, self.timeout)
			}, this.timeout)
		}
	}
$(function(){
	/*$("#min_title_list li").contextMenu('Huiadminmenu', {
		bindings: {
			'closethis': function(t) {
				console.log(t);
				if(t.find("i")){
					t.find("i").trigger("click");
				}		
			},
			'closeall': function(t) {
				alert('Trigger was '+t.id+'\nAction was Email');
			},
		}
	});*/
});
/*信息*/
function broadcast_look(title,url,w,h){
	broadcast = 0;
	document.getElementById("broadcast_news").innerHTML= broadcast;
	layer_show(title,url,w,h);
}
/*个人信息*/
function myselfinfo(){
	layer.open({
		type: 1,
		area: ['300px','200px'],
		fix: false, //不固定
		maxmin: true,
		shade:0.4,
		title: '查看信息',
		content: '<div>管理员信息</div>'
	});
}

/*资讯-添加*/
function article_add(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*图片-添加*/
function picture_add(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*产品-添加*/
function product_add(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*用户-添加*/
function member_add(title,url,w,h){
	layer_show(title,url,w,h);
}


</script> 


</body>
</html>